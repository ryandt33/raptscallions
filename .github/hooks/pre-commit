#!/bin/bash
#
# Pre-commit hook for Raptscallions
# Runs type checking, linting, and tests before allowing commit
#
# To install this hook:
#   cp .github/hooks/pre-commit .git/hooks/pre-commit
#   chmod +x .git/hooks/pre-commit
#
# To bypass (not recommended):
#   git commit --no-verify

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo ""
echo -e "${YELLOW}Running pre-commit checks...${NC}"
echo ""

# Check if pnpm is available
if ! command -v pnpm &> /dev/null; then
    echo -e "${RED}✗ pnpm not found. Please install pnpm.${NC}"
    exit 1
fi

# Type checking
echo -e "${YELLOW}→ Type checking...${NC}"
if pnpm typecheck; then
    echo -e "${GREEN}✓ Type checking passed${NC}"
else
    echo -e "${RED}✗ Type checking failed${NC}"
    exit 1
fi

# Linting
echo -e "${YELLOW}→ Linting...${NC}"
if pnpm lint; then
    echo -e "${GREEN}✓ Linting passed${NC}"
else
    echo -e "${RED}✗ Linting failed${NC}"
    echo -e "${YELLOW}  Try running: pnpm lint --fix${NC}"
    exit 1
fi

# Run tests (only for staged files)
echo -e "${YELLOW}→ Running tests...${NC}"
if pnpm test; then
    echo -e "${GREEN}✓ Tests passed${NC}"
else
    echo -e "${RED}✗ Tests failed${NC}"
    exit 1
fi

echo ""
echo -e "${GREEN}✓ All pre-commit checks passed!${NC}"
echo ""

exit 0
