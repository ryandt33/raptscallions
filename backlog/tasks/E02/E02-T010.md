---
id: "E02-T010"
title: "Make database connection pool settings configurable"
status: "todo"
priority: "medium"
epic: "E02"
depends_on: []
blocks: []
labels: ["follow-up", "configuration", "database"]
---

# Make Database Connection Pool Settings Configurable

## Description

Enable runtime configuration of PostgreSQL connection pool settings (min/max connections) through environment variables instead of using hardcoded values. The environment schema already defines `DATABASE_POOL_MIN` and `DATABASE_POOL_MAX` with sensible defaults, but these validated settings are not currently used when creating the connection pool.

## Why This Matters

Production deployments need the ability to tune connection pool size based on available resources, expected load, and database server capacity without requiring code changes. Different environments (development, staging, production) have different resource constraints and should be able to configure pool settings independently. This is especially important for:

- High-traffic production environments that need larger pools
- Resource-constrained staging environments that need smaller pools
- Multi-tenant deployments with varying database server sizes
- Performance tuning and load testing scenarios

## Acceptance Criteria

- [ ] AC1: Connection pool reads `DATABASE_POOL_MAX` from validated environment configuration
- [ ] AC2: Connection pool reads `DATABASE_POOL_MIN` from validated environment configuration (if postgres driver supports it)
- [ ] AC3: Falls back to sensible defaults (max: 10, min: 2) when environment variables are not set
- [ ] AC4: Pool configuration changes take effect when environment variables are modified
- [ ] AC5: Documentation explains pool sizing recommendations for different deployment scenarios
- [ ] AC6: Existing tests still pass without modification (defaults work)
- [ ] AC7: New tests verify pool settings are read from environment correctly

## Constraints

- Performance: Must not introduce additional overhead during connection pool creation
- Compatibility: Must maintain backward compatibility with existing deployments that don't set these variables
- Validation: Must use the already-validated environment from `validateDbEnv()`, not read raw process.env
- Defaults: Current defaults (max: 10, min: 2) should remain as fallbacks

## Out of Scope

- Dynamic pool resizing at runtime (requires connection pool restart)
- Connection pool monitoring/metrics (deferred to telemetry epic)
- Alternative connection pooling strategies (e.g., external poolers like PgBouncer)
- Per-application connection pool configuration (assumes single pool per app)

## Context

This addresses a suggestion from the E01-T003 code review ([backlog/docs/reviews/E01/E01-T003-code-review.md](../../docs/reviews/E01/E01-T003-code-review.md)):

> "**Connection pooling not using env variables**: The `dbEnvSchema` defines `DATABASE_POOL_MIN` and `DATABASE_POOL_MAX`, but `client.ts` uses hardcoded values (max: 10). Consider reading from validated environment or documenting that these env vars are for reference only."

The environment validation is already in place in [packages/db/src/env.ts](../../../packages/db/src/env.ts) with appropriate defaults. The issue is that [packages/db/src/client.ts](../../../packages/db/src/client.ts) doesn't consume these validated settings.

See ARCHITECTURE.md for database configuration patterns and CONVENTIONS.md for environment variable handling conventions.
