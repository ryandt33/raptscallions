---
id: "E06-T004"
title: "CI integration for docs validation"
status: "todo"
priority: "high"
epic: "E06"
depends_on: ["E06-T001", "E06-T003"]
blocks: []
---

# CI Integration for Docs Validation

## Description

Add documentation validation to the CI pipeline. This includes building the VitePress site, checking for broken links, and reporting stale documentation.

## Why This Matters

CI enforcement ensures documentation quality doesn't degrade over time. Build failures catch broken markdown or VitePress configuration. Link checking prevents dead references. Staleness reports create visibility into documentation debt.

## Acceptance Criteria

- [ ] AC1: GitHub Actions workflow includes docs build step
- [ ] AC2: VitePress build failure blocks PR merge
- [ ] AC3: Broken internal links detected and reported
- [ ] AC4: Staleness check runs and generates report
- [ ] AC5: Staleness report attached as PR comment or annotation
- [ ] AC6: Staleness does NOT block merge (warning only, initially)
- [ ] AC7: Workflow runs only when apps/docs/** or relevant code changes
- [ ] AC8: Build artifacts (static site) available for preview
- [ ] AC9: Documentation of CI behavior in contributing guide

## Constraints

- Must integrate with existing CI workflows
- Should not significantly increase CI time (target: <60 seconds for docs)
- Staleness check requires git history (full checkout, not shallow)
- PR preview deployment is optional (out of scope for this task)

## Out of Scope

- Automated deployment to hosting
- PR preview environments
- Spell checking
- Style/grammar linting
- External link checking (just internal)

## Context

### Workflow Triggers

```yaml
on:
  push:
    paths:
      - 'apps/docs/**'
      - 'packages/**'  # For staleness detection
      - 'apps/api/**'  # For staleness detection
  pull_request:
    paths:
      - 'apps/docs/**'
```

### Jobs

1. **build-docs**: Run `pnpm --filter docs build`
2. **check-links**: Validate internal links
3. **check-stale**: Run staleness detection, report results

### Staleness Reporting

For PRs, add a check annotation or comment:

```markdown
## Documentation Staleness Report

**2 potentially stale docs detected:**

- `apps/docs/src/auth/concepts/session-lifecycle.md`
  - Related file `session.service.ts` changed 5 days after last verification
- `apps/docs/src/api/patterns/error-handling.md`
  - Related file `errors.ts` changed 12 days after last verification

Consider running `/update-docs` to refresh these docs.
```

### Integration Points

- Existing `.github/workflows/` directory
- Existing PR checks (typecheck, lint, test)
- pnpm scripts from E06-T001 and E06-T003
