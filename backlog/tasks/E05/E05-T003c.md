---
id: "E05-T003c"
title: "S3 backend integration tests with MinIO"
status: "todo"
priority: "high"
task_type: "backend"
workflow: "development"
labels: [backend, testing, integration, s3]
assignee: ""
workflow_state: "PR_READY"
epic: "E05"
agentic_style: "outcome-focused"
depends_on: ["E05-T003a", "E05-T003b"]
blocks: ["E05-T005"]
breakpoint: false
assigned_agent: ""
created_at: "2026-01-16T00:00:00Z"
updated_at: "2026-01-18T00:00:00Z"
spec_file: "backlog/docs/specs/E05/E05-T003c-spec.md"
test_files: ["packages/storage/src/__tests__/integration/s3.backend.integration.test.ts"]
code_files: ["packages/storage/src/__tests__/integration/s3.backend.integration.test.ts"]
pr_url: ""
---

# E05-T003c: S3 backend integration tests with MinIO

## Description

Create integration tests that verify the S3 storage backend works correctly with a real MinIO instance. Tests should cover the complete file lifecycle (upload → download → delete) and validate signed URL functionality.

## Why This Matters

Unit tests with mocked S3 clients can't catch real-world issues like connection handling, authentication, and S3 API quirks. Integration tests with MinIO prove the backend actually works before deploying to production with real S3.

## Acceptance Criteria

- [ ] AC1: Tests run against real MinIO container (docker-compose)
- [ ] AC2: Complete lifecycle test: upload → download → verify content → delete
- [ ] AC3: Signed URL test: generate URL → fetch directly → verify content
- [ ] AC4: Error handling test: operations on non-existent objects
- [ ] AC5: Storage key format is verified (correct path structure)
- [ ] AC6: Tests clean up after themselves (no orphaned test files)
- [ ] AC7: Tests can run in CI/CD pipeline with docker-compose
- [ ] AC8: Test coverage for S3 backend reaches 80%+

## Constraints

- Tests must start/stop MinIO cleanly (or use existing docker-compose)
- Test isolation: each test uses unique keys to avoid conflicts
- Cleanup: test files must be deleted even if tests fail
- CI compatibility: must work with GitHub Actions docker support
- Timeout: individual tests should complete in <30 seconds

## Workflow

**Category:** `development` (standard)

**Rationale:** Integration test development follows TDD - write test scenarios first, then implement test code.

**Phases:**
1. `/analyze` - Research Vitest integration testing patterns, docker-compose test setup
2. Human approval of approach
3. `/review-plan` - Architect validates test strategy
4. `/write-tests` - Write integration test file (tests will fail until MinIO is running)
5. `/implement` - Implement test utilities and fixtures
6. `/review-code` - Fresh-eyes review of test quality
7. `/qa` - Run tests with docker-compose, verify all pass
8. `/update-docs` - Document how to run integration tests
9. PR creation

## Out of Scope

- S3 backend implementation (E05-T003a)
- MinIO Docker setup (E05-T003b)
- Production S3 testing (E05-T003d)
- Performance/load testing
- Concurrent upload stress testing
- Testing with actual AWS S3 (uses MinIO only)

## Context

- Requires MinIO from E05-T003b to be running
- Uses S3 backend from E05-T003a
- Follow existing integration test patterns (if any) in the codebase
- Vitest is the test framework (see package.json)
- Tests should be in `packages/storage/src/__tests__/` directory

## History

| Date | State | Agent | Notes |
| ---- | ----- | ----- | ----- |
| 2026-01-18 | PR_READY | writer | Docs updated; added integration testing section to S3 backend KB page; updated integration-tests.md with real-service pattern link |
| 2026-01-18 | INTEGRATION_TESTING | qa | QA PASS; all 17 integration tests pass with MinIO; all 8 ACs verified; 234 total tests pass |
| 2026-01-18 | QA_REVIEW | reviewer | Code review APPROVED; excellent test structure, all 8 ACs verified, 3 minor suggestions (non-blocking) |
| 2026-01-18 | IMPLEMENTED | developer | All 17 integration tests pass against MinIO; tests cover complete lifecycle, signed URLs, error handling, key formats, and cleanup; all 234 storage package tests pass |
| 2026-01-18 | TESTS_READY | developer | Integration tests written; 17 test cases covering AC1-AC6, edge cases; tests skip gracefully when MinIO unavailable |
| 2026-01-18 | APPROVED | architect | Spec created; single-file integration test approach with Docker Compose MinIO |
| 2026-01-16 | REPLANNED | pm | Split from E05-T003 - focused on integration testing |
| 2026-01-13 | DRAFT | pm | Original task created for Epic E05 |

## Documentation Updates

**KB Documentation:**

- Updated: `apps/docs/src/storage/patterns/s3-backend.md`
  - Added "Integration Tests with MinIO" section with test patterns
  - Added `related_code` entry for integration test file
  - Added backlog reference for E05-T003c in Related Pages
  - Set `last_verified: 2026-01-18`

- Updated: `apps/docs/src/testing/patterns/integration-tests.md`
  - Added real-service integration test pattern reference
  - Added tip callout linking to S3 backend integration tests
  - Added `related_code` entry for S3 integration test file
  - Updated Related Pages with E05-T003c reference
  - Set `last_verified: 2026-01-18`

**Verification:**

- Build check passed (no broken links)
- All KB pages include backlog references
