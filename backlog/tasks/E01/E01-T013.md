---
id: "E01-T013"
title: "Document Database Migration Workflow"
status: "todo"
priority: "medium"
labels: [documentation, database, developer-experience]
assignee: ""
epic: "E01"
depends_on: ["E01-T009"]
blocks: []
created_at: "2026-01-14T20:00:00Z"
---

# E01-T013: Document Database Migration Workflow

## Description

Create comprehensive developer documentation for the database migration workflow, covering day-to-day migration tasks, PostgreSQL enum handling patterns, troubleshooting common issues, and when to use each migration command. Developers currently have a working migration system but lack clear guidance on best practices and edge cases.

## Why This Matters

**Onboarding:** New developers need clear, step-by-step guidance to make their first database change confidently. Without documentation, they'll either ask teammates repeatedly or make mistakes that break the migration workflow.

**Consistency:** Documentation ensures all team members follow the same migration patterns, preventing "it works on my machine" issues and reducing code review friction on database changes.

**Incident Prevention:** Well-documented enum migration patterns and troubleshooting guides prevent the types of critical incidents discovered in E04-T009 (push vs migrate confusion, enum alteration failures).

## Acceptance Criteria

- [ ] AC1: Step-by-step guide for creating and applying migrations exists
- [ ] AC2: PostgreSQL enum migration pattern documented with code examples
- [ ] AC3: Decision tree for `push` vs `migrate` vs `generate` commands included
- [ ] AC4: Common migration errors documented with solutions (troubleshooting section)
- [ ] AC5: Migration rollback strategy explained with examples
- [ ] AC6: `CONVENTIONS.md` migration section updated with current workflow
- [ ] AC7: `README.md` setup instructions include migration workflow
- [ ] AC8: Documentation includes example migration for reference
- [ ] AC9: Links to E04-T009 example migration (`0010_enhance_chat_sessions.sql`) as exemplar

## Constraints

- **Audience:** Documentation targets developers with basic SQL knowledge (no PostgreSQL experts assumed)
- **Format:** Must be accessible markdown files, not external wikis or tools
- **Maintainability:** Keep documentation close to code (in `docs/` directory)
- **Completeness:** Cover common scenarios (80% use case coverage, not every edge case)
- **Clarity:** Use concrete examples, not abstract explanations
- **Findability:** Link from `README.md` so new developers discover it immediately

## Out of Scope

- Advanced PostgreSQL tuning or optimization (separate performance docs)
- ORM comparison or "why Drizzle" justification (covered in ARCHITECTURE.md)
- Database backup and recovery procedures (infrastructure/ops concern)
- Migration versioning strategies beyond sequential numbering
- Schema design principles (separate database design guide)
- Video tutorials or interactive guides (markdown only for MVP)

## Context

**Related Work:**
- E01-T009 spec (lines 455-516) contains enum migration guide that should be extracted to docs
- E01-T009 spec (lines 527-530) lists files to create (use as starting point)
- Code review for E01-T009 identified documentation as AC5 (implementation pending)

**Documentation Structure:**

**Primary Document: `docs/database-migrations.md`**
- Introduction: Why migrations matter, when to use them
- Quick Start: Generate → Review → Apply workflow (5-minute guide)
- Command Reference: `db:generate`, `db:migrate`, `db:push`, `db:studio`, `db:migrate:check`
- PostgreSQL Enum Patterns: Rename-recreate-drop with data migration examples
- Common Scenarios: Adding columns, renaming tables, changing types, indexes
- Troubleshooting: Migration fails, schema drift, enum errors, rollback
- Best Practices: Review SQL, test migrations, commit schema + SQL together

**Secondary Updates:**
- `docs/CONVENTIONS.md` lines 452-457: Update with current workflow, link to detailed guide
- `README.md`: Add "Database Migrations" section to development setup
- `packages/db/README.md`: Link to main docs, provide quick reference

**Example References:**
- `packages/db/src/migrations/0010_enhance_chat_sessions.sql` — Exemplar enum migration
- E01-T009 spec — Source material for migration patterns and edge cases

**Tone and Style:**
- Imperative voice ("Run `pnpm db:generate`", not "You should run...")
- Step-by-step instructions with code blocks
- ⚠️ callouts for dangerous operations (DROP, enum changes)
- ✅ callouts for success indicators ("You should see...")

**Success Indicators:**
- Developer can create first migration without asking for help
- Zero incidents from misusing `push` vs `migrate`
- Code reviews on migrations reference docs (not oral tradition)
