---
id: "E01-T011"
title: "Add Pre-commit Hook for Migration Validation"
status: "todo"
priority: "medium"
labels: [infrastructure, database, developer-tooling]
assignee: ""
epic: "E01"
depends_on: ["E01-T009"]
blocks: []
created_at: "2026-01-14T20:00:00Z"
---

# E01-T011: Add Pre-commit Hook for Migration Validation

## Description

Enable automatic migration validation before every Git commit to catch schema drift and migration issues early in the development workflow. Developers currently must remember to run validation manually, which can lead to committing schema changes without corresponding migrations.

## Why This Matters

**Developer Safety:** Pre-commit validation prevents developers from accidentally committing schema changes without migrations, catching issues immediately rather than discovering them later in CI or production. This reduces debugging time and prevents migration-related incidents.

**Team Productivity:** Automated validation eliminates the cognitive load of remembering to check migrations manually. Developers get instant feedback when they forget to generate a migration, with clear instructions on how to fix the issue.

## Acceptance Criteria

- [ ] AC1: Pre-commit hook file exists and is executable
- [ ] AC2: Hook runs migration validation (`db:migrate:check`) before commit
- [ ] AC3: Hook blocks commits when validation fails with clear error message
- [ ] AC4: Hook provides actionable feedback (e.g., "Run: pnpm db:generate")
- [ ] AC5: Developers can bypass hook if needed (`git commit --no-verify`)
- [ ] AC6: Hook setup documented in developer onboarding docs
- [ ] AC7: Hook installation verified with simple test command
- [ ] AC8: Hook runs fast enough not to disrupt developer flow (<5 seconds)

## Constraints

- **Performance:** Must complete validation in under 5 seconds to avoid frustrating developers
- **Cross-platform:** Should work on Unix/Linux/macOS (primary development environments)
- **Non-intrusive:** Must not interfere with non-database commits (quick exit if no schema changes)
- **Clear messaging:** Error output must be immediately understandable and actionable
- **Opt-out available:** Developers must be able to bypass for legitimate reasons (--no-verify)

## Out of Scope

- Automatic migration generation (developers must still run `db:generate` manually)
- Windows-specific Git hook support (Docker/WSL is primary Windows workflow)
- Complex validation beyond schema drift detection (covered by existing `migrate-check.ts`)
- Commit message validation or linting (separate concern)
- Server-side Git hooks (this is local developer tooling only)

## Context

**Related Work:**
- E01-T009 created the `db:migrate:check` validation script that this hook will invoke
- Code review for E01-T009 identified pre-commit hook as AC3 (implementation pending)

**Technical Context:**
- Git hooks location: `.github/hooks/pre-commit` (project convention)
- Hook must be installed via `git config core.hooksPath .github/hooks`
- Validation script available: `pnpm --filter @raptscallions/db db:migrate:check`
- Script already handles graceful degradation (Git not available, no migrations, etc.)

**Developer Experience:**
- Hook should print clear status: "ðŸ” Validating database migrations..."
- On success: Quiet (don't slow down normal commits)
- On failure: Show errors from `migrate-check.ts` + hint to use `--no-verify` if intentional
- Installation: Document in `docs/CONTRIBUTING.md` or `README.md` setup section

**Pattern Reference:**
See E04-T009 spec (lines 387-403) for original pre-commit hook design guidance.
