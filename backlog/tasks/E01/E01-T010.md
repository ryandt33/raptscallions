---
id: "E01-T010"
title: "Configure ESLint for Monorepo"
status: "done"
priority: "medium"
labels: [infrastructure, tooling, code-quality]
assignee: ""
workflow_state: "PR_READY"
epic: "E01"
depends_on: ["E01-T001", "E01-T008"]
blocks: []
breakpoint: false
assigned_agent: ""
created_at: "2026-01-14T19:00:00Z"
updated_at: "2026-01-14T23:30:00Z"
spec_file: "backlog/docs/specs/E01/E01-T010-spec.md"
test_files: []
code_files: [
  "eslint.config.js",
  ".vscode/settings.json",
  "package.json",
  "packages/core/package.json",
  "packages/db/package.json",
  "packages/auth/package.json",
  "packages/modules/package.json",
  "packages/telemetry/package.json",
  "packages/ai/package.json",
  "apps/api/package.json",
  "apps/docs/package.json",
  "docs/CONVENTIONS.md",
  "apps/docs/src/contributing/eslint-setup.md",
  "apps/docs/src/.vitepress/config.ts"
]
pr_url: ""
---

# E01-T010: Configure ESLint for Monorepo

## Description

Set up ESLint configuration for the entire monorepo to enforce code quality and consistency. Currently, the root `package.json` defines a `lint` script that runs `pnpm -r lint`, but none of the workspace packages (`packages/core`, `packages/db`, `packages/auth`, etc.) have a `lint` script configured. This causes the root lint command to fail.

**Current Issue:**

- Root `package.json:18` defines: `"lint": "pnpm -r lint"`
- No packages define a `lint` script in their `package.json`
- CI requirement per `docs/references/initial_planning/github.md` requires linting to pass
- Pre-commit hooks may attempt to run linting

**Impact:**

- Cannot run `pnpm lint` from root (used in CI/CD per GitHub rules)
- No automated code quality checks
- Inconsistent code style across packages
- CI/CD will fail when GitHub Actions are configured

## Acceptance Criteria

### Configuration

- [ ] AC1: ESLint configuration file created at root (`eslint.config.js` using flat config)
- [ ] AC2: TypeScript ESLint plugin configured for all `.ts` and `.tsx` files
- [ ] AC3: Recommended ESLint rules enabled with TypeScript-specific rules
- [ ] AC4: Import sorting and ordering rules configured
- [ ] AC5: Configuration extends appropriate presets for Node.js and React
- [ ] AC6: Monorepo-aware import resolution configured

### Package Scripts

- [ ] AC7: All packages in `packages/` have `lint` script: `"lint": "eslint src --ext .ts,.tsx"`
- [ ] AC8: All packages have `lint:fix` script: `"lint:fix": "eslint src --ext .ts,.tsx --fix"`
- [ ] AC9: Root `package.json` has `lint:fix` script: `"lint:fix": "pnpm -r lint:fix"`

### Developer Experience

- [ ] AC10: Running `pnpm lint` from root successfully lints all packages
- [ ] AC11: Running `pnpm lint:fix` from root auto-fixes issues in all packages
- [ ] AC12: ESLint errors fail with clear, actionable messages
- [ ] AC13: VS Code ESLint extension works correctly with configuration

### Dependencies

- [ ] AC14: ESLint and required plugins added as dev dependencies at root
- [ ] AC15: TypeScript ESLint parser and plugin configured
- [ ] AC16: No unnecessary or conflicting plugins installed

### Validation

- [ ] AC17: Existing codebase passes linting (or all violations documented/fixed)
- [ ] AC18: Linting runs in under 30 seconds for full monorepo
- [ ] AC19: Configuration doesn't conflict with TypeScript compiler

## Technical Notes

### Current State Analysis

**Packages missing lint script:**
- `packages/core/package.json` - No lint script
- `packages/db/package.json` - No lint script
- `packages/auth/package.json` - No lint script
- `packages/modules/package.json` - No lint script
- `packages/telemetry/package.json` - No lint script
- `packages/ai/package.json` - No lint script

**Root configuration:**
- `package.json:18` - `"lint": "pnpm -r lint"` exists but fails
- `package.json:23` - `"ci:check": "pnpm typecheck && pnpm lint && pnpm test && pnpm build"`
- No ESLint config file at root level

### Recommended ESLint Configuration

**Flat Config Format (`eslint.config.js`):**

Modern ESLint uses flat config instead of `.eslintrc` files. Use the new format for better TypeScript support and performance.

**Core Rules:**
- `@typescript-eslint/recommended` - TypeScript-specific linting
- `@typescript-eslint/strict` - Stricter type safety rules
- No `any` type usage (per CLAUDE.md conventions)
- Import/export ordering rules
- Unused variable detection
- Prefer const over let where applicable

**Ignore Patterns:**
- `dist/` - Build output
- `node_modules/` - Dependencies
- `*.config.js` - Config files (or configure separately)
- `__tests__/__fixtures__/` - Test fixtures

### Package Scripts Format

Each package should have:

```json
{
  "scripts": {
    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix"
  }
}
```

Root should have:

```json
{
  "scripts": {
    "lint": "pnpm -r lint",
    "lint:fix": "pnpm -r lint:fix"
  }
}
```

### VS Code Integration

Ensure `.vscode/settings.json` (if exists) has:

```json
{
  "eslint.validate": ["typescript", "typescriptreact"],
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  }
}
```

### Performance Considerations

- Use flat config for faster resolution
- Enable caching: `--cache` flag in scripts if needed
- Avoid overly broad glob patterns
- Consider `--max-warnings 0` to treat warnings as errors

## Dependencies

**Depends on:**
- E01-T001 - Monorepo must be initialized
- E01-T008 - Vitest configuration (ensures test setup is complete)

**Blocks:**
- GitHub Actions CI/CD setup (requires working lint command)
- Pre-commit hook configuration (requires working lint command)

## Implementation Checklist

### Phase 1: ESLint Installation

- [ ] Install ESLint core at root: `pnpm add -Dw eslint`
- [ ] Install TypeScript ESLint: `pnpm add -Dw typescript-eslint`
- [ ] Install additional plugins if needed (import sorting, etc.)
- [ ] Verify installations: `pnpm eslint --version`

### Phase 2: Configuration

- [ ] Create `eslint.config.js` at root using flat config format
- [ ] Configure TypeScript parser and plugin
- [ ] Set up recommended rules for Node.js and TypeScript
- [ ] Configure import sorting/ordering rules
- [ ] Add ignore patterns (dist, node_modules, etc.)
- [ ] Test configuration on sample file: `pnpm eslint packages/core/src/index.ts`

### Phase 3: Package Scripts

- [ ] Add `lint` and `lint:fix` scripts to `packages/core/package.json`
- [ ] Add `lint` and `lint:fix` scripts to `packages/db/package.json`
- [ ] Add `lint` and `lint:fix` scripts to `packages/auth/package.json`
- [ ] Add `lint` and `lint:fix` scripts to `packages/modules/package.json`
- [ ] Add `lint` and `lint:fix` scripts to `packages/telemetry/package.json`
- [ ] Add `lint` and `lint:fix` scripts to `packages/ai/package.json`
- [ ] Add `lint:fix` script to root `package.json`
- [ ] Test: `pnpm lint` from root (should run on all packages)

### Phase 4: Fix Existing Issues

- [ ] Run `pnpm lint` and capture all errors
- [ ] Document or fix all violations
- [ ] Run `pnpm lint:fix` to auto-fix what's possible
- [ ] Manually fix remaining issues
- [ ] Verify: `pnpm lint` exits with 0 status

### Phase 5: Documentation

- [ ] Update `docs/CONVENTIONS.md` with ESLint rules and usage
- [ ] Add linting section to README.md if applicable
- [ ] Document common ESLint errors and fixes
- [ ] Add VS Code setup instructions for ESLint extension

### Phase 6: Integration Testing

- [ ] Test `pnpm ci:check` command completes successfully
- [ ] Verify linting runs in under 30 seconds
- [ ] Test that TypeScript errors don't duplicate ESLint errors
- [ ] Verify VS Code ESLint extension works with configuration

## Edge Cases

1. **Config files (*.config.js):** May need different rules or be excluded from linting
2. **Test files:** May need relaxed rules (any type for mocks, console.log allowed)
3. **Migration files:** SQL files in `packages/db/src/migrations/` should be excluded
4. **Generated files:** Drizzle types or other generated code should be excluded
5. **React components (future):** Will need React-specific ESLint rules when `apps/web` is added

## Success Criteria

**Technical:**
- `pnpm lint` runs successfully on entire monorepo
- `pnpm lint:fix` auto-fixes issues without errors
- `pnpm ci:check` passes with linting included
- Linting completes in < 30 seconds

**Developer Experience:**
- Clear, actionable error messages for violations
- VS Code shows linting errors inline
- Auto-fix works reliably for common issues
- Configuration doesn't slow down development

**Code Quality:**
- No `any` types in codebase (per conventions)
- Consistent import ordering across packages
- Unused variables detected and removed
- TypeScript-specific issues caught by ESLint

## Related Documentation

- `docs/CONVENTIONS.md` - Code style guide (needs ESLint section)
- `.claude/rules/github.md` - CI/CD requirements mention linting
- Root `package.json:18,23` - Lint scripts that currently don't work

## History

| Date | State | Agent | Notes |
| ---- | ----- | ----- | ----- |
| 2026-01-14 | DRAFT | Claude | Task created in response to developer comment identifying missing lint scripts in db package. Investigation confirmed no packages have lint scripts configured, blocking CI/CD requirements. |
| 2026-01-14 | ANALYZED | analyst | Comprehensive implementation spec created at `backlog/docs/specs/E01/E01-T010-spec.md`. Spec includes ESLint 9.x flat config with TypeScript ESLint v8, strict `any` ban rules, import ordering, package script configuration for 6 packages and 2 apps, VS Code integration, detailed implementation checklist with 9 phases, edge case handling, and documentation updates for CONVENTIONS.md. |
| 2026-01-14 | IMPLEMENTED | developer | ESLint configuration complete. Installed ESLint 9.39.2 with typescript-eslint 8.x, created flat config with strict rules (zero `any` tolerance, explicit return types, import ordering). Added lint scripts to all 6 packages and 2 apps. Created .vscode/settings.json for auto-fix on save. Fixed all violations across codebase: import ordering, missing return types, unused variables, type-safe alternatives to `any`. Added comprehensive ESLint section to docs/CONVENTIONS.md. All packages pass `pnpm lint` with zero errors/warnings. |

## Documentation Updates

**KB Documentation:**

- **Created:** `apps/docs/src/contributing/eslint-setup.md` (new page)
  - Comprehensive ESLint configuration guide (600+ lines)
  - Migrated substantial content from CONVENTIONS.md ESLint section
  - Added sections: Configuration overview, critical rules, code quality rules, common violations with fixes, VS Code integration, disabling rules, CI integration, performance, extending configuration
  - Code examples extracted from actual implementation and violations
  - Frontmatter set: `related_code` includes eslint.config.js, .vscode/settings.json, package.json files
  - `implements_task: E01-T010`, `last_verified: 2026-01-14`
- **Updated:** `apps/docs/src/.vitepress/config.ts`
  - Added "ESLint Configuration" link to Contributing sidebar navigation

**Legacy Documentation:**

- **Updated:** `docs/CONVENTIONS.md` - ESLint section (lines 461-491)
  - Replaced 150+ line detailed section with concise 30-line summary
  - Added cross-reference to KB page: `apps/docs/src/contributing/eslint-setup.md`
  - Kept quick reference commands and key rules summary
  - Directs readers to KB for full documentation

**Verification:**

- ✅ Build check passed: `pnpm docs:build` completes successfully (5.45s)
- ✅ No broken links detected
- ✅ Fixed dead link to backlog spec (changed to GitHub URL)
- ⚠️  Staleness check not available (E06-T003 not implemented yet)

**Summary:**

Successfully migrated substantial ESLint documentation from CONVENTIONS.md to dedicated KB page as requested. KB page provides comprehensive reference with examples, while CONVENTIONS.md maintains high-level overview with cross-reference. Documentation is complete and ready for PR.

## Reviews

### Plan Review

- **Reviewer:** architect
- **Date:**
- **Verdict:**
- **Notes:**

### Code Review

- **Reviewer:** reviewer
- **Date:**
- **Verdict:**
- **Notes:**

### QA Review

- **Reviewer:** qa
- **Date:**
- **Verdict:**
- **Notes:**
