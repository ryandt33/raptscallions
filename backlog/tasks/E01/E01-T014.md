---
id: "E01-T014"
title: "Create Interactive Migration Helper Script"
status: "todo"
priority: "low"
labels: [developer-tooling, database, enhancement, optional]
assignee: ""
epic: "E01"
depends_on: ["E01-T009", "E01-T013"]
blocks: []
created_at: "2026-01-14T20:00:00Z"
---

# E01-T014: Create Interactive Migration Helper Script

## Description

Build an interactive CLI tool that guides developers through the migration creation process step-by-step, validating each step and providing context-aware suggestions. This is a developer experience enhancement that reduces the learning curve for database changes.

## Why This Matters

**Reduced Friction:** Interactive prompts lower the barrier to making database changes, especially for developers who don't work with migrations frequently. Instead of remembering commands and flags, they answer questions.

**Fewer Errors:** Step-by-step validation catches mistakes early (invalid migration names, missing reviews, skipped tests) before developers commit and push to CI.

**Best Practices Embedded:** The tool encodes migration best practices (review SQL, check for enums, run tests) so developers naturally follow the correct workflow without needing to memorize documentation.

**Note:** This is a **nice-to-have enhancement**, not critical path. The manual workflow (E01-T009) is fully functional.

## Acceptance Criteria

- [ ] AC1: Interactive script prompts for migration name/description
- [ ] AC2: Script validates migration name follows convention (NNNN_description)
- [ ] AC3: Script runs `db:generate` and shows output
- [ ] AC4: Script opens generated migration in editor for review
- [ ] AC5: Script detects enum changes and warns about rename-recreate-drop pattern
- [ ] AC6: Script prompts to run `db:migrate` to apply locally
- [ ] AC7: Script prompts to run tests after migration applied
- [ ] AC8: Script provides summary of next steps (commit files, create PR)
- [ ] AC9: Script accessible via `pnpm db:new` or similar memorable command

## Constraints

- **Cross-platform:** Should work on Unix/Linux/macOS (primary platforms)
- **Dependencies:** Minimize external dependencies (use Node.js built-ins where possible)
- **Performance:** Must respond quickly to prompts (<100ms between steps)
- **Non-blocking:** Developers can Ctrl+C out at any time without corruption
- **Editor detection:** Should respect `$EDITOR` environment variable
- **Fallback:** If interactive features fail, fall back to basic guidance

## Out of Scope

- GUI or web-based migration tool (CLI only)
- AI-assisted migration generation (manual review required)
- Automatic schema diffing or change detection (Drizzle handles this)
- Integration with external tools (Jira, Slack) for migration tracking
- Migration scheduling or delayed application (immediate apply only)
- Multi-database support (PostgreSQL only)

## Context

**Related Work:**
- E01-T009 provides the underlying migration scripts this tool wraps
- E01-T013 documentation should be referenced by helper script
- Code review for E01-T009 identified this as AC6 (nice-to-have)

**Technical Context:**
- Script location: `packages/db/scripts/migration-helper.ts`
- Entry point: Add to `packages/db/package.json` as `db:new` script
- Interactive library: Consider `prompts` or Node.js built-in `readline`
- Editor opening: Use `child_process.spawn($EDITOR, [file])`

**Workflow Steps:**
1. Prompt for migration description
2. Generate migration name from description (auto-number + slugify)
3. Run `drizzle-kit generate` with generated name
4. Open migration file in editor (wait for close)
5. Ask: "Does this migration alter enums? [y/N]"
   - If yes: Show enum pattern reminder, ask to confirm reviewed
6. Ask: "Apply migration locally? [Y/n]"
   - If yes: Run `db:migrate`, show output
7. Ask: "Run tests? [Y/n]"
   - If yes: Run `pnpm test`, show results
8. Show summary:
   - âœ… Migration generated: `0011_description.sql`
   - âœ… Applied locally
   - âœ… Tests passing
   - ðŸ“ Next: Commit schema + migration, create PR

**Example Interaction:**
```
$ pnpm db:new

ðŸŽ¯ Interactive Migration Helper

? Migration description: Add user preferences table
âœ“ Generated: 0011_add_user_preferences_table.sql
â³ Opening in editor... (close when reviewed)
âœ“ Review complete

? Does this migration alter PostgreSQL enums? No
? Apply migration locally? Yes
âœ“ Migration applied successfully

? Run tests? Yes
â³ Running tests...
âœ“ All tests passing (429/429)

ðŸ“‹ Summary:
  Migration: 0011_add_user_preferences_table.sql
  Status: Applied and tested
  Next steps:
    1. git add packages/db/src/schema packages/db/src/migrations
    2. git commit -m "feat(db): add user preferences table"
    3. Create PR
```

**Optional Enhancements (Future):**
- Detect common patterns (adding column, renaming table) and suggest SQL
- Check for breaking changes (DROP COLUMN, NOT NULL without DEFAULT)
- Estimate migration duration based on table size
- Generate rollback migration template

**Success Indicators:**
- Developers choose helper script over manual workflow
- Fewer migration mistakes in code review
- Positive feedback from team on UX
