---
id: "E04-T004"
title: "SessionService with message persistence"
status: "todo"
priority: "high"
labels: [backend]
assignee: ""
workflow_state: "DRAFT"
epic: "E04"
depends_on: ["E04-T001"]
blocks: ["E04-T005"]
breakpoint: false
assigned_agent: ""
created_at: "2026-01-12T00:00:00Z"
updated_at: "2026-01-12T00:00:00Z"
spec_file: ""
test_files: []
code_files: []
pr_url: ""
---

# E04-T004: SessionService with message persistence

## Description

Implement SessionService for creating/managing chat sessions and persisting messages with proper sequencing.

## Acceptance Criteria

- [ ] AC1: SessionService.create creates new session
- [ ] AC2: SessionService.getById retrieves session with messages
- [ ] AC3: SessionService.addMessage persists message with auto-incremented seq
- [ ] AC4: SessionService.getMessages returns ordered message history
- [ ] AC5: SessionService.complete transitions state to completed
- [ ] AC6: Session validation (user owns session, session is active)
- [ ] AC7: Message validation (non-empty content, valid role)
- [ ] AC8: Tests verify sequencing and state transitions
- [ ] AC9: Error handling for invalid states
- [ ] AC10: TypeScript types for service methods

## History

| Date | State | Agent | Notes |
| ---- | ----- | ----- | ----- |
| 2026-01-12 | DRAFT | pm | Task created |

## Reviews

### Plan Review
- **Reviewer:** architect
- **Date:**
- **Verdict:**
- **Notes:**

### Code Review
- **Reviewer:** reviewer
- **Date:**
- **Verdict:**
- **Notes:**

### QA Review
- **Reviewer:** qa
- **Date:**
- **Verdict:**
- **Notes:**
