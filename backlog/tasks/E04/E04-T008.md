---
id: "E04-T008"
title: "Chat integration tests"
status: "todo"
priority: "high"
labels: [backend, testing]
assignee: ""
workflow_state: "DRAFT"
epic: "E04"
depends_on: ["E04-T007"]
blocks: []
breakpoint: false
assigned_agent: ""
created_at: "2026-01-12T00:00:00Z"
updated_at: "2026-01-12T00:00:00Z"
spec_file: ""
test_files: []
code_files: []
pr_url: ""
---

# E04-T008: Chat integration tests

## Description

Write comprehensive integration tests for the complete chat flow from session creation through multi-turn conversations with mocked AI responses.

## Acceptance Criteria

- [ ] AC1: Test session creation from tool
- [ ] AC2: Test sending messages and receiving streaming responses
- [ ] AC3: Test multi-turn conversation (context building)
- [ ] AC4: Test session completion
- [ ] AC5: Test message persistence and sequencing
- [ ] AC6: Test usage tracking after each message
- [ ] AC7: Test error handling (invalid session, AI errors)
- [ ] AC8: Test permission checks (session ownership)
- [ ] AC9: Mock OpenRouter responses
- [ ] AC10: 80%+ coverage of chat code

## Technical Notes

Mock OpenRouter with pre-defined responses. Test full flow end-to-end with real database.

## History

| Date | State | Agent | Notes |
| ---- | ----- | ----- | ----- |
| 2026-01-12 | DRAFT | pm | Task created |

## Reviews

### Plan Review
- **Reviewer:** architect
- **Date:**
- **Verdict:**
- **Notes:**

### Code Review
- **Reviewer:** reviewer
- **Date:**
- **Verdict:**
- **Notes:**

### QA Review
- **Reviewer:** qa
- **Date:**
- **Verdict:**
- **Notes:**
